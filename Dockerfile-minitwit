FROM ubuntu:18.04

# Updating packages
RUN apt-get update

# ---------------------------------------
#          Repository Setup
# ---------------------------------------

RUN apt-get -y install git
RUN echo "CLONING REPOSITORY"
RUN git clone https://github.com/JesperFalkenberg/devops2021.git -b feature/deploy
RUN echo "INSTALLING MAVEN"
RUN apt install maven -y
WORKDIR "/devops2021/java-itu-minitwit"
RUN echo "BUILDING PROJECT"
RUN mvn package
WORKDIR "/devops2021/java-itu-minitwit/target"

RUN nohup java -jar java-itu-minitwit-1.0-SNAPSHOT.jar

RUN echo "================================================================="
RUN echo "=                            DONE                               ="
RUN echo "================================================================="
RUN echo "Navigate in your browser to:"
RUN THIS_IP=`hostname -I | cut -d" " -f1`
RUN echo "http://${THIS_IP}:4567"

EXPOSE 4567
